<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>SharePoint Mindmap – St. Josef</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
      #mindmap {
        width: 100vw;
        height: 100vh;
      }
      #loading {
        position: absolute;
        top: 10px;
        left: 10px;
        padding: 6px 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        font-size: 12px;
        border-radius: 4px;
        z-index: 10;
      }
      #error {
        position: absolute;
        top: 40px;
        left: 10px;
        padding: 6px 10px;
        background: rgba(180,0,0,0.8);
        color: white;
        font-size: 12px;
        border-radius: 4px;
        z-index: 10;
        display: none;
        max-width: 90vw;
        white-space: pre-wrap;
      }
    </style>
  </head>

  <body>
    <div id="loading">Lade Mindmap …</div>
    <div id="error"></div>
    <svg id="mindmap"></svg>

    <!-- Markmap / D3 von CDN laden -->
    <script src="https://unpkg.com/markmap-lib@0.14.4/dist/browser/index.min.js"></script>
    <script src="https://unpkg.com/d3@6.7.0/dist/d3.min.js"></script>
    <script src="https://unpkg.com/markmap-view@0.14.4/dist/index.min.js"></script>

    <script>
      // mindmap.md liegt im gleichen Ordner wie index.html
      const MD_URL = './mindmap.md';

      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('error');
      const svg = document.getElementById('mindmap');

      async function loadMindmap() {
        try {
          const res = await fetch(MD_URL);
          if (!res.ok) {
            throw new Error('HTTP ' + res.status + ' ' + res.statusText);
          }
          const markdown = await res.text();

          const { markmap } = window;
          const { Markmap, loadCSS, loadJS, Transformer } = markmap;

          const transformer = new Transformer();
          const { root, features } = transformer.transform(markdown);
          const { styles, scripts } = transformer.getUsedAssets(features);

          if (styles) loadCSS(styles);
          if (scripts) loadJS(scripts, { getMarkmap: () => markmap });

          Markmap.create('#mindmap', null, root);

          loadingEl.style.display = 'none';
        } catch (err) {
          console.error(err);
          loadingEl.style.display = 'none';
          errorEl.style.display = 'block';
          errorEl.textContent =
            'Fehler beim Laden der Mindmap:\n' +
            (err && err.message ? err.message : String(err)) +
            '\n\nStimmt der Dateiname (mindmap.md) und liegt die Datei im gleichen Ordner wie index.html?';
        }
      }

      loadMindmap();
    </script>
  </body>
</html>
